<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Onet Crystal Pro 2026 üíé</title>
    <style>
        :root { 
            --accent: #d4ff00; 
            --glass: rgba(0, 0, 0, 0.85);
            --crystal: 1px solid rgba(255, 255, 255, 0.2);
        }
        * { box-sizing: border-box; touch-action: manipulation; }
        body { 
            margin: 0; padding: 0;
            background: #000 url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?q=80&w=1932') no-repeat center center fixed;
            background-size: cover; font-family: 'Segoe UI', sans-serif; color: white;
            display: flex; flex-direction: column; height: 100dvh; overflow: hidden;
        }

        /* HEADER & TIMER */
        .header { background: var(--glass); padding: env(safe-area-inset-top) 0 5px; border-bottom: 1px solid #f1c40f; flex-shrink: 0; }
        .info { display: flex; justify-content: space-around; font-weight: 900; font-size: clamp(10px, 3vw, 14px); color: #f1c40f; }
        .timer-box { width: 95%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 10px; margin: 4px auto; overflow: hidden; }
        #timer-bar { width: 100%; height: 100%; background: linear-gradient(90deg, #00ff00, #ffff00, #ff0000); transition: 0.3s; }

        /* MENU N√öT */
        .menu { display: flex; justify-content: center; gap: 2dvw; padding: 5px; flex-shrink: 0; }
        .btn { 
            background: rgba(255,255,255,0.1); border: var(--crystal); border-radius: 8px; 
            padding: 8px 15px; color: white; font-size: clamp(9px, 2.5vw, 12px); font-weight: bold; cursor: pointer;
            backdrop-filter: blur(5px); text-transform: uppercase;
        }

        /* V√ôNG GAME: QUY·∫æT ƒê·ªäNH ƒê·ªò TR√ÄN M√ÄN H√åNH */
        .game-area { 
            flex-grow: 1; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            padding: 5px;
            overflow: hidden;
            position: relative;
        }

        /* B√ÄN C·ªú T·ª∞ ƒê·ªòNG CƒÇN THEO DVMIN */
        #board { 
            display: grid; 
            grid-template-columns: repeat(12, 1fr); 
            grid-template-rows: repeat(7, 1fr);
            gap: 0.5dvmin; /* Kho·∫£ng c√°ch gi·ªØa c√°c √¥ t·ª± co gi√£n */
            width: 98dvw; /* Lu√¥n chi·∫øm g·∫ßn h·∫øt chi·ªÅu ngang */
            height: 75dvh; /* Gi·ªõi h·∫°n chi·ªÅu cao ƒë·ªÉ c√¢n ƒë·ªëi tr√™n d∆∞·ªõi */
            max-width: 140dvh; /* Ch·ªëng b·ªã qu√° b√® tr√™n m√°y t√≠nh */
            margin: auto;
        }

        .tile { 
            position: relative;
            background: rgba(255,255,255,0.1); 
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10%; /* Bo g√≥c theo t·ªâ l·ªá */
            display: flex; 
            align-items: center; 
            justify-content: center;
            font-size: 5dvmin; /* Font ch·ªØ t·ª± to nh·ªè theo m√†n h√¨nh */
            transition: 0.1s;
            cursor: pointer;
            user-select: none;
        }
        
        .tile.active { background: #ff3e3e; border-color: white; transform: scale(1.1); z-index: 5; box-shadow: 0 0 15px #ff3e3e; }
        .tile.hint { background: var(--accent); border-color: white; animation: pulse 0.5s infinite; }
        .tile.hide { visibility: hidden; pointer-events: none; }

        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.1);} 100% {transform: scale(1);} }

        /* OVERLAYS */
        #fullscreen-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 300; display: flex; align-items: center; justify-content: center; }
        .start-card { background: var(--glass); border: 2px solid var(--accent); padding: 30px; border-radius: 20px; text-align: center; }
        .big-play-btn { padding: 15px 40px; background: var(--accent); color: #000; border: none; border-radius: 50px; font-weight: 900; font-size: 20px; }

        #rotate-overlay { position: fixed; inset: 0; background: #000; z-index: 400; display: none; flex-direction: column; align-items: center; justify-content: center; }
        @media (orientation: portrait) { #rotate-overlay { display: flex; } }
    </style>
</head>
<body>

<div id="rotate-overlay"><h2 style="color: var(--accent)">üîÑ XOAY NGANG M√ÅY ƒêI N√ç!</h2></div>

<div id="fullscreen-overlay">
    <div class="start-card">
        <h1 style="color:var(--accent); margin:0">ONET CRYSTAL PRO üíé</h1>
        <p>T·ª± ƒë·ªông l·∫Øp ƒë·∫ßy m·ªçi m√†n h√¨nh!</p>
        <button class="big-play-btn" onclick="startWithFull()">V√ÄO GAME üöÄ</button>
    </div>
</div>

<div class="header">
    <div class="info">
        <div>üí∞ <span id="xu">500</span></div>
        <div>LV <span id="lv">1</span></div>
        <div>PTS <span id="pts">0</span></div>
    </div>
    <div class="timer-box"><div id="timer-bar"></div></div>
</div>

<div class="menu">
    <div class="btn" onclick="autoFind()">üîç G·ª¢I √ù (300)</div>
    <div class="btn" onclick="manualShuffle()">üîÑ ƒê·∫¢O (100)</div>
</div>

<div class="game-area"><div id="board"></div></div>

<audio id="m_bg" loop src="Nhac.mp3"></audio>
<audio id="s_ok" src="dung.mp3"></audio>
<audio id="s_no" src="sai.mp3"></audio>
<audio id="s_tap" src="khi_nhan_nut.mp3"></audio>

<script>
    const R=7, C=12;
    const icons = ['üßß','üèÆ','üçä','üå∏','üß®','üéã','üí∞','‚ú®','üçé','üçë','üçç','üçâ','üç±','ü¶Å','üéç','ü™Å','üçá','üçì','ü•®','ü•ë','üçÑ','üåà'];
    let map=[], pick=null, xu=500, pts=0, lv=1, time=100, timer;

    function sound(id){ const a=document.getElementById(id); if(a){ a.currentTime=0; a.play().catch(()=>{}); } }

    function startWithFull(){
        if(document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
        document.getElementById('fullscreen-overlay').style.display = 'none';
        document.getElementById('m_bg').play().catch(()=>{});
        init();
    }

    function init(){
        clearInterval(timer); time=100;
        map = Array.from({length:R+2},()=>Array(C+2).fill(null));
        let items = [];
        for(let i=0; i<(R*C)/2; i++) items.push(icons[i%icons.length], icons[i%icons.length]);
        items.sort(()=>Math.random()-0.5);
        let k=0;
        for(let r=1; r<=R; r++) for(let c=1; c<=C; c++) map[r][c]=items[k++];
        checkAndShuffleIfNeeded();
        draw(); startTimer();
    }

    function draw(){
        const b = document.getElementById('board'); b.innerHTML='';
        for(let r=1; r<=R; r++) for(let c=1; c<=C; c++){
            const d = document.createElement('div');
            d.className = 'tile' + (map[r][c]?'':' hide');
            d.id = `tile-${r}-${c}`;
            d.innerHTML = map[r][c]||'';
            d.onclick = () => click(d,r,c);
            b.appendChild(d);
        }
        document.getElementById('xu').innerText=xu;
        document.getElementById('lv').innerText=lv;
        document.getElementById('pts').innerText=pts;
    }

    function hasAvailableMoves(){
        for(let r1=1; r1<=R; r1++) for(let c1=1; c1<=C; c1++){
            if(!map[r1][c1]) continue;
            for(let r2=1; r2<=R; r2++) for(let c2=1; c2<=C; c2++){
                if((r1===r2 && c1===c2) || !map[r2][c2] || map[r1][c1]!==map[r2][c2]) continue;
                if(check(r1,c1,r2,c2)) return true;
            }
        }
        return false;
    }

    function checkAndShuffleIfNeeded(){
        if(map.flat().every(v => v === null)) return;
        if(!hasAvailableMoves()){
            let items = map.flat().filter(v => v !== null);
            items.sort(() => Math.random() - 0.5);
            let k=0;
            for(let r=1; r<=R; r++) for(let c=1; c<=C; c++) if(map[r][c]) map[r][c] = items[k++];
            checkAndShuffleIfNeeded(); 
        }
    }

    function manualShuffle(){
        if(xu < 100) return;
        xu -= 100;
        let items = map.flat().filter(v => v !== null);
        items.sort(() => Math.random() - 0.5);
        let k=0;
        for(let r=1; r<=R; r++) for(let c=1; c<=C; c++) if(map[r][c]) map[r][c] = items[k++];
        draw();
    }

    function autoFind(){
        if(xu < 300) return;
        for(let r1=1; r1<=R; r1++) for(let c1=1; c1<=C; c1++){
            if(!map[r1][c1]) continue;
            for(let r2=1; r2<=R; r2++) for(let c2=1; c2<=C; c2++){
                if((r1===r2 && c1===c2) || !map[r2][c2] || map[r1][c1]!==map[r2][c2]) continue;
                if(check(r1,c1,r2,c2)){
                    xu -= 300;
                    document.getElementById(`tile-${r1}-${c1}`).classList.add('hint');
                    document.getElementById(`tile-${r2}-${c2}`).classList.add('hint');
                    setTimeout(()=>{ handleMatch(r1,c1,r2,c2); }, 400);
                    return;
                }
            }
        }
    }

    function click(el,r,c){
        sound('s_tap');
        if(!pick){ pick={el,r,c}; el.classList.add('active'); }
        else {
            if(pick.r===r && pick.c===c){ el.classList.remove('active'); pick=null; return; }
            if(map[pick.r][pick.c]===map[r][c] && check(pick.r,pick.c,r,c)){
                handleMatch(pick.r, pick.c, r, c);
            } else { sound('s_no'); }
            if(pick) pick.el.classList.remove('active'); pick=null;
        }
    }

    function handleMatch(r1,c1,r2,c2){
        sound('s_ok');
        map[r1][c1] = map[r2][c2] = null;
        xu += 10; pts += 5;
        if(Math.random() < 0.05) {
            let items = map.flat().filter(v => v !== null);
            items.sort(() => Math.random() - 0.5);
            let k=0;
            for(let r=1; r<=R; r++) for(let c=1; c<=C; c++) if(map[r][c]) map[r][c] = items[k++];
        }
        checkAndShuffleIfNeeded();
        draw();
        if(map.flat().every(v => v === null)){ lv++; xu+=200; init(); }
    }

    function check(r1,c1,r2,c2){
        const q=[{r:r1,c:c1,d:-1,t:0}]; const v=new Map();
        while(q.length>0){
            const curr=q.shift();
            if(curr.t>2) continue;
            if(curr.r===r2 && curr.c===c2) return true;
            [[0,1],[0,-1],[1,0],[-1,0]].forEach(([dr,dc],i)=>{
                let nr=curr.r+dr, nc=curr.c+dc;
                if(nr>=0 && nr<=R+1 && nc>=0 && nc<=C+1){
                    if(map[nr][nc]===null || (nr===r2 && nc===c2)){
                        let nt = (curr.d!==-1 && curr.d!==i)?curr.t+1:curr.t;
                        let k=`${nr}-${nc}-${i}`;
                        if(!v.has(k) || v.get(k)>nt){ v.set(k,nt); q.push({r:nr,c:nc,d:i,t:nt}); }
                    }
                }
            });
        } return false;
    }

    function startTimer(){
        timer = setInterval(()=>{
            time -= 0.2;
            document.getElementById('timer-bar').style.width = time+"%";
            if(time<=0){ clearInterval(timer); location.reload(); }
        },1000);
    }
</script>
</body>
</html>
